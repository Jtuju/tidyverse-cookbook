<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>4 Transform Tables | The Tidyverse Cookbook</title>
  <meta name="description" content="How to solve common data science tasks with R’s Tidyverse">
  <meta name="generator" content="bookdown  and GitBook 2.6.7">

  <meta property="og:title" content="4 Transform Tables | The Tidyverse Cookbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="How to solve common data science tasks with R’s Tidyverse" />
  <meta name="github-repo" content="rstudio-education/tidyverse-cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Transform Tables | The Tidyverse Cookbook" />
  
  <meta name="twitter:description" content="How to solve common data science tasks with R’s Tidyverse" />
  

<meta name="author" content="Edited by Garrett Grolemund">


<meta name="date" content="2018-12-19">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="tidy.html">
<link rel="next" href="transform-lists.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Tidyverse Cookbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="how-to-use-this-book.html"><a href="how-to-use-this-book.html"><i class="fa fa-check"></i>How to use this book</a></li>
<li class="part"><span><b>I The Recipes</b></span></li>
<li class="chapter" data-level="1" data-path="program.html"><a href="program.html"><i class="fa fa-check"></i><b>1</b> Program</a></li>
<li class="chapter" data-level="2" data-path="import.html"><a href="import.html"><i class="fa fa-check"></i><b>2</b> Import</a></li>
<li class="chapter" data-level="3" data-path="tidy.html"><a href="tidy.html"><i class="fa fa-check"></i><b>3</b> Tidy</a></li>
<li class="chapter" data-level="4" data-path="transform-tables.html"><a href="transform-tables.html"><i class="fa fa-check"></i><b>4</b> Transform Tables</a></li>
<li class="chapter" data-level="5" data-path="transform-lists.html"><a href="transform-lists.html"><i class="fa fa-check"></i><b>5</b> Transform Lists</a></li>
<li class="chapter" data-level="6" data-path="transform-data-vectors.html"><a href="transform-data-vectors.html"><i class="fa fa-check"></i><b>6</b> Transform Data Vectors</a></li>
<li class="chapter" data-level="7" data-path="transform-strings.html"><a href="transform-strings.html"><i class="fa fa-check"></i><b>7</b> Transform Strings</a></li>
<li class="chapter" data-level="8" data-path="transform-factors.html"><a href="transform-factors.html"><i class="fa fa-check"></i><b>8</b> Transform Factors</a></li>
<li class="chapter" data-level="9" data-path="transform-dates-and-times.html"><a href="transform-dates-and-times.html"><i class="fa fa-check"></i><b>9</b> Transform Dates and Times</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Tidyverse Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="transform-tables" class="section level1">
<h1><span class="header-section-number">4</span> Transform Tables</h1>
<hr />
<div class="col2">
<ol style="list-style-type: decimal">
<li><a href="transform-tables.html#arrange-rows-in-ascending-order-by-the-values-of-a-column">Arrange rows in ascending order by the values of a column</a></li>
<li><a href="transform-tables.html#arrange-rows-in-descending-order-by-the-values-of-a-column">Arrange rows in descending order by the values of a column</a></li>
<li><a href="transform-tables.html#filter-rows-with-a-logical-test">Filter rows with a logical test</a></li>
<li><a href="transform-tables.html#select-columns-by-name">Select columns by name</a></li>
<li><a href="transform-tables.html#drop-columns-by-name">Drop columns by name</a></li>
<li><a href="transform-tables.html#select-a-range-of-columns">Select a range of columns</a></li>
<li><a href="transform-tables.html#select-columns-by-integer-position">Select columns by integer position</a></li>
<li><a href="transform-tables.html#select-columns-by-start-of-name">Select columns by start of name</a></li>
<li><a href="transform-tables.html#select-columns-by-end-of-name">Select columns by end of name</a></li>
<li><a href="transform-tables.html#select-columns-by-string-in-name">Select columns by string in name</a></li>
<li><a href="transform-tables.html#reorder-columns">Reorder columns</a></li>
<li><a href="transform-tables.html#reorder-columns-without-naming-all-columns">Reorder columns without naming all columns</a></li>
<li><a href="transform-tables.html#rename-columns">Rename columns</a></li>
<li><a href="transform-tables.html#return-the-contents-of-a-column-as-a-vector">Return the contents of a column as a vector</a></li>
<li><a href="transform-tables.html#summarise-data">Summarise data</a></li>
<li><a href="transform-tables.html#summarise-data-by-groups">Summarise data by groups</a></li>
<li><a href="transform-tables.html#mutate-data-add-new-variables">Mutate data (Add new variables)</a></li>
<li><a href="transform-tables.html#combine-transform-recipes">Combine transform recipes</a></li>
<li><a href="transform-tables.html#join-data-sets-by-common-columns">Join data sets by common column(s)</a></li>
<li><a href="transform-tables.html#filter-one-data-set-against-another">Filter one data set against another</a></li>
</ol>
</div>
<hr />
<div id="what-you-should-know-before-you-begin-3" class="section level2 unnumbered">
<h2>What you should know before you begin</h2>

<div class="rmdcaution">
Tidyverse functions that transform tables do not transform your original table, which is preserved in its original form under its original name. Tidyverse functions instead return a modified copy of the table, which can be passed to the next function in a pipe, or assigned to a name for later use.
</div>


<div class="rmdcaution">
dplyr functions will match column names that appear within their arguments to columns in the data frame that they are manipulating. To avoid this behavior, place <code>!!</code> before a name to unquote it, e.g. <code>!!model</code>.
</div>


<div class="rmdcaution">
<p>Transforming a table sometimes requires more than one recipe. Why? Because tables are made of multiple data structures that work together:</p>
<ol style="list-style-type: decimal">
<li>The table itself is a data frame or tibble.<br />
</li>
<li>The columns of the table are vectors.<br />
</li>
<li>Some columns may be list-columns, which are lists that contain vectors.</li>
</ol>
This matters because one of the <a href="how-to-use-this-book.html#what-is-the-tidyverse">design philosophies of the tidyverse</a> is that each function should focus on one task and do it well. Functions that do one task well tend to work with one type of data structure. So to transform a table, you often need to combine a function that manipulates tables with a function that manipulates data vectors and maybe a function that manipulates lists. See <a href="transform-tables.html#combine-transform-recipes">Combine transform recipes</a> for tips.
</div>

</div>
<div id="arrange-rows-in-ascending-order-by-the-values-of-a-column" class="section level2">
<h2><span class="header-section-number">4.1</span> Arrange rows in ascending order by the values of a column</h2>
<p>You want to sort the rows of a data frame in <strong>ascending</strong> order by the values in one or more columns.</p>
<div id="solution-20" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">mpg <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(cty)</code></pre>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 dodge        dako…   4.7  2008     8 auto… 4         9    12 e     pick…
##  2 dodge        dura…   4.7  2008     8 auto… 4         9    12 e     suv  
##  3 dodge        ram …   4.7  2008     8 auto… 4         9    12 e     pick…
##  4 dodge        ram …   4.7  2008     8 manu… 4         9    12 e     pick…
##  5 jeep         gran…   4.7  2008     8 auto… 4         9    12 e     suv  
##  6 chevrolet    c150…   5.3  2008     8 auto… r        11    15 e     suv  
##  7 chevrolet    k150…   5.3  2008     8 auto… 4        11    14 e     suv  
##  8 chevrolet    k150…   5.7  1999     8 auto… 4        11    15 r     suv  
##  9 dodge        cara…   3.3  2008     6 auto… f        11    17 e     mini…
## 10 dodge        dako…   5.2  1999     8 manu… 4        11    17 r     pick…
## # ... with 224 more rows</code></pre>
</div>
<div id="discussion-19" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>arrange()</code> sorts the rows according to the values of the specified column, with the lowest values appearing near the top of the data frame. <code>arrange()</code> will use additional columns as tiebreakers to sort within rows that share the same value of the first column.</p>
<pre class="sourceCode r"><code class="sourceCode r">mpg <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(cty, hwy)</code></pre>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 dodge        dako…   4.7  2008     8 auto… 4         9    12 e     pick…
##  2 dodge        dura…   4.7  2008     8 auto… 4         9    12 e     suv  
##  3 dodge        ram …   4.7  2008     8 auto… 4         9    12 e     pick…
##  4 dodge        ram …   4.7  2008     8 manu… 4         9    12 e     pick…
##  5 jeep         gran…   4.7  2008     8 auto… 4         9    12 e     suv  
##  6 chevrolet    k150…   5.3  2008     8 auto… 4        11    14 e     suv  
##  7 jeep         gran…   6.1  2008     8 auto… 4        11    14 p     suv  
##  8 chevrolet    c150…   5.3  2008     8 auto… r        11    15 e     suv  
##  9 chevrolet    k150…   5.7  1999     8 auto… 4        11    15 r     suv  
## 10 dodge        dako…   5.2  1999     8 auto… 4        11    15 r     pick…
## # ... with 224 more rows</code></pre>
</div>
</div>
<div id="arrange-rows-in-descending-order-by-the-values-of-a-column" class="section level2">
<h2><span class="header-section-number">4.2</span> Arrange rows in descending order by the values of a column</h2>
<p>You want to sort the rows of a data frame in <strong>descending</strong> order by the values in one or more columns.</p>
<div id="solution-21" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">mpg <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(cty))</code></pre>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 volkswagen   new …   1.9  1999     4 manu… f        35    44 d     subc…
##  2 volkswagen   jetta   1.9  1999     4 manu… f        33    44 d     comp…
##  3 volkswagen   new …   1.9  1999     4 auto… f        29    41 d     subc…
##  4 honda        civic   1.6  1999     4 manu… f        28    33 r     subc…
##  5 toyota       coro…   1.8  2008     4 manu… f        28    37 r     comp…
##  6 honda        civic   1.8  2008     4 manu… f        26    34 r     subc…
##  7 toyota       coro…   1.8  1999     4 manu… f        26    35 r     comp…
##  8 toyota       coro…   1.8  2008     4 auto… f        26    35 r     comp…
##  9 honda        civic   1.6  1999     4 manu… f        25    32 r     subc…
## 10 honda        civic   1.8  2008     4 auto… f        25    36 r     subc…
## # ... with 224 more rows</code></pre>
</div>
<div id="discussion-20" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>Place <code>desc()</code> around a column name to cause <code>arrange()</code> to sort by descending values of that column. You can use <code>desc()</code> for tie-breaker columns as well.</p>
<pre class="sourceCode r"><code class="sourceCode r">mpg <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(cty, <span class="kw">desc</span>(hwy))</code></pre>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 dodge        dako…   4.7  2008     8 auto… 4         9    12 e     pick…
##  2 dodge        dura…   4.7  2008     8 auto… 4         9    12 e     suv  
##  3 dodge        ram …   4.7  2008     8 auto… 4         9    12 e     pick…
##  4 dodge        ram …   4.7  2008     8 manu… 4         9    12 e     pick…
##  5 jeep         gran…   4.7  2008     8 auto… 4         9    12 e     suv  
##  6 dodge        cara…   3.3  2008     6 auto… f        11    17 e     mini…
##  7 dodge        dako…   5.2  1999     8 manu… 4        11    17 r     pick…
##  8 ford         expe…   4.6  1999     8 auto… r        11    17 r     suv  
##  9 ford         expe…   5.4  1999     8 auto… r        11    17 r     suv  
## 10 lincoln      navi…   5.4  1999     8 auto… r        11    17 r     suv  
## # ... with 224 more rows</code></pre>
</div>
</div>
<div id="filter-rows-with-a-logical-test" class="section level2">
<h2><span class="header-section-number">4.3</span> Filter rows with a logical test</h2>
<p>You want to filter your table to just the rows that meet a specific condition.</p>
<div id="solution-22" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">mpg <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(model <span class="op">==</span><span class="st"> &quot;jetta&quot;</span>)</code></pre>
<pre><code>## # A tibble: 9 x 11
##   manufacturer model displ  year   cyl trans  drv     cty   hwy fl    class
##   &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
## 1 volkswagen   jetta   1.9  1999     4 manua… f        33    44 d     comp…
## 2 volkswagen   jetta   2    1999     4 manua… f        21    29 r     comp…
## 3 volkswagen   jetta   2    1999     4 auto(… f        19    26 r     comp…
## 4 volkswagen   jetta   2    2008     4 auto(… f        22    29 p     comp…
## 5 volkswagen   jetta   2    2008     4 manua… f        21    29 p     comp…
## 6 volkswagen   jetta   2.5  2008     5 auto(… f        21    29 r     comp…
## 7 volkswagen   jetta   2.5  2008     5 manua… f        21    29 r     comp…
## 8 volkswagen   jetta   2.8  1999     6 auto(… f        16    23 r     comp…
## 9 volkswagen   jetta   2.8  1999     6 manua… f        17    24 r     comp…</code></pre>
</div>
<div id="discussion-21" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>filter()</code> takes a logical test and returns the rows for which the logical test returns <code>TRUE</code>. <code>filter()</code> will match column names that appear within the logical test to columns in your data frame.</p>
<p><code>filter()</code> will combine multiple logical tests with an AND operator (<code>&amp;</code>):</p>
<pre class="sourceCode r"><code class="sourceCode r">mpg <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(model <span class="op">==</span><span class="st"> &quot;jetta&quot;</span>, year <span class="op">==</span><span class="st"> </span><span class="dv">1999</span>)</code></pre>
<pre><code>## # A tibble: 5 x 11
##   manufacturer model displ  year   cyl trans  drv     cty   hwy fl    class
##   &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
## 1 volkswagen   jetta   1.9  1999     4 manua… f        33    44 d     comp…
## 2 volkswagen   jetta   2    1999     4 manua… f        21    29 r     comp…
## 3 volkswagen   jetta   2    1999     4 auto(… f        19    26 r     comp…
## 4 volkswagen   jetta   2.8  1999     6 auto(… f        16    23 r     comp…
## 5 volkswagen   jetta   2.8  1999     6 manua… f        17    24 r     comp…</code></pre>
<p>See <code>?Comparison</code> and <code>?Logic</code> to learn more about writing logical tests in R.</p>
</div>
</div>
<div id="select-columns-by-name" class="section level2">
<h2><span class="header-section-number">4.4</span> Select columns by name</h2>
<p>You want to return a “subset” of columns from your data frame by listing the name of each column to return.</p>
<div id="solution-23" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(country, year, cases)</code></pre>
<pre><code>## # A tibble: 6 x 3
##   country      year  cases
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan  1999    745
## 2 Afghanistan  2000   2666
## 3 Brazil       1999  37737
## 4 Brazil       2000  80488
## 5 China        1999 212258
## 6 China        2000 213766</code></pre>
<!-- I couldn't find table1 anywhere in a search, may want to provide code for people at the top to generate? Or at least cross-reference -->
</div>
<div id="discussion-22" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>select()</code> returns a new data frame that includes each column passed to <code>select()</code>. Repeat a name to include the column twice.</p>
</div>
</div>
<div id="drop-columns-by-name" class="section level2">
<h2><span class="header-section-number">4.5</span> Drop columns by name</h2>
<p>You want to return a “subset” of columns from your data frame by listing the name of each column to drop.</p>
<div id="solution-24" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(population, year))</code></pre>
<pre><code>## # A tibble: 6 x 2
##   country      cases
##   &lt;chr&gt;        &lt;int&gt;
## 1 Afghanistan    745
## 2 Afghanistan   2666
## 3 Brazil       37737
## 4 Brazil       80488
## 5 China       212258
## 6 China       213766</code></pre>
</div>
<div id="discussion-23" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>If you use a <code>-</code> before a column name, <code>select()</code> will return every column in the data frame except that column. To drop more than one column at a time, group the columns into a vector preceded by <code>-</code>.</p>
</div>
</div>
<div id="select-a-range-of-columns" class="section level2">
<h2><span class="header-section-number">4.6</span> Select a range of columns</h2>
<p>You want to return two columns from a data frame as well as every column that appears between them.</p>
<div id="solution-25" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(country<span class="op">:</span>cases)</code></pre>
<pre><code>## # A tibble: 6 x 3
##   country      year  cases
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan  1999    745
## 2 Afghanistan  2000   2666
## 3 Brazil       1999  37737
## 4 Brazil       2000  80488
## 5 China        1999 212258
## 6 China        2000 213766</code></pre>
</div>
<div id="discussion-24" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>If you combine two column names with a <code>:</code>, <code>select()</code> will return both columns and every column that appears between them in the data frame.</p>
</div>
</div>
<div id="select-columns-by-integer-position" class="section level2">
<h2><span class="header-section-number">4.7</span> Select columns by integer position</h2>
<p>You want to return a “subset” of columns from your data frame by listing the position of each column to return.</p>
<div id="solution-26" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)</code></pre>
<pre><code>## # A tibble: 6 x 3
##   country      year population
##   &lt;chr&gt;       &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999   19987071
## 2 Afghanistan  2000   20595360
## 3 Brazil       1999  172006362
## 4 Brazil       2000  174504898
## 5 China        1999 1272915272
## 6 China        2000 1280428583</code></pre>
</div>
<div id="discussion-25" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>select()</code> interprets the whole number <em>n</em> as the _n_th column in the data set. You can combine numbers with <code>-</code> and <code>:</code> inside of <code>select()</code> as well.</p>
</div>
</div>
<div id="select-columns-by-start-of-name" class="section level2">
<h2><span class="header-section-number">4.8</span> Select columns by start of name</h2>
<p>You want to return evey column in your data that begins with a specific string.</p>
<div id="solution-27" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;c&quot;</span>))</code></pre>
<pre><code>## # A tibble: 6 x 2
##   country      cases
##   &lt;chr&gt;        &lt;int&gt;
## 1 Afghanistan    745
## 2 Afghanistan   2666
## 3 Brazil       37737
## 4 Brazil       80488
## 5 China       212258
## 6 China       213766</code></pre>
</div>
</div>
<div id="select-columns-by-end-of-name" class="section level2">
<h2><span class="header-section-number">4.9</span> Select columns by end of name</h2>
<p>You want to return evey column in your data that ends with a specific string.</p>
<div id="solution-28" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;tion&quot;</span>))</code></pre>
<pre><code>## # A tibble: 6 x 1
##   population
##        &lt;int&gt;
## 1   19987071
## 2   20595360
## 3  172006362
## 4  174504898
## 5 1272915272
## 6 1280428583</code></pre>
</div>
</div>
<div id="select-columns-by-string-in-name" class="section level2">
<h2><span class="header-section-number">4.10</span> Select columns by string in name</h2>
<p>You want to return evey column in your data whose name contains a specific string or regular expression.</p>
<div id="solution-29" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;o.*u&quot;</span>))</code></pre>
<pre><code>## # A tibble: 6 x 2
##   country     population
##   &lt;chr&gt;            &lt;int&gt;
## 1 Afghanistan   19987071
## 2 Afghanistan   20595360
## 3 Brazil       172006362
## 4 Brazil       174504898
## 5 China       1272915272
## 6 China       1280428583</code></pre>
</div>
<div id="discussion-26" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>o.*u</code> is a regular expression that matches an <code>o</code> followed by a <code>u</code> with any number of characters in between. <code>country</code> and <code>population</code> are returned because the names <code>country</code> and <code>population</code> each contain an <code>o</code> followed (at any distance) by a <code>u</code>.</p>
</div>
</div>
<div id="reorder-columns" class="section level2">
<h2><span class="header-section-number">4.11</span> Reorder columns</h2>
<p>You want to return all of the columns in the original data frame in a new order.</p>
<div id="solution-30" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(country, year, population, cases)</code></pre>
<pre><code>## # A tibble: 6 x 4
##   country      year population  cases
##   &lt;chr&gt;       &lt;int&gt;      &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan  1999   19987071    745
## 2 Afghanistan  2000   20595360   2666
## 3 Brazil       1999  172006362  37737
## 4 Brazil       2000  174504898  80488
## 5 China        1999 1272915272 212258
## 6 China        2000 1280428583 213766</code></pre>
</div>
<div id="discussion-27" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>Use <code>select()</code> to select all of the columns in the new order.</p>
</div>
</div>
<div id="reorder-columns-without-naming-all-columns" class="section level2">
<h2><span class="header-section-number">4.12</span> Reorder columns without naming all columns</h2>
<p>You want to reorder some of the columns in the original data frame, but you don’t care about the order for other columns, and you may have too many columns to name them each individually.</p>
<div id="solution-31" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(country, year, <span class="kw">everything</span>())</code></pre>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
</div>
<div id="discussion-28" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>Use <code>everything()</code> within <code>select()</code> to select all of the columns in the order they are named: all columns are kept, and no columns are duplicated. Using <code>everything()</code> preserves the original ordering of the original (unnamed) columns.</p>
</div>
</div>
<div id="rename-columns" class="section level2">
<h2><span class="header-section-number">4.13</span> Rename columns</h2>
<p>You want to rename one or more columns in your data frame, retaining the rest.</p>
<div id="solution-32" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">state =</span> country, <span class="dt">date =</span> year)</code></pre>
<pre><code>## # A tibble: 6 x 4
##   state        date  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
</div>
<div id="discussion-29" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>For each column to be renamed, type a new name for the column and set it equal to the old name for the column.</p>
</div>
</div>
<div id="return-the-contents-of-a-column-as-a-vector" class="section level2">
<h2><span class="header-section-number">4.14</span> Return the contents of a column as a vector</h2>
<p>You want to return the contents of a single column as a vector, not as a data frame with one column.</p>
<div id="solution-33" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pull</span>(cases)</code></pre>
<pre><code>## [1]    745   2666  37737  80488 212258 213766</code></pre>
</div>
<div id="discussion-30" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>pull()</code> comes in the dplyr package. You can also pull a column by integer position:</p>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pull</span>(<span class="dv">3</span>)</code></pre>
<pre><code>## [1]    745   2666  37737  80488 212258 213766</code></pre>
</div>
</div>
<div id="summarise-data" class="section level2">
<h2><span class="header-section-number">4.15</span> Summarise data</h2>
<p>You want to compute summary statistics for your data set.</p>
<div id="solution-34" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(cases), <span class="dt">max_rate =</span> <span class="kw">max</span>(cases<span class="op">/</span>population))</code></pre>
<pre><code>## # A tibble: 1 x 2
##   total_cases max_rate
##         &lt;int&gt;    &lt;dbl&gt;
## 1      547660 0.000461</code></pre>
</div>
<div id="discussion-31" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>When used by itself, <code>summarise()</code> returns a new 1 x n tibble. Each argument name passed to <code>summarise()</code> will become a column name in the tibble. Each column will contain the result of the R expression passed to the argument/column name.</p>
<p><code>summarise()</code> is intended to be used with <em>summary functions</em>, which are functions that take a vector of values as input and return a single value as output (e.g <code>sum()</code>, <code>max()</code>, <code>mean()</code>).</p>
<p><code>summarize()</code> is an alias for <code>summarise()</code>.</p>
</div>
</div>
<div id="summarise-data-by-groups" class="section level2">
<h2><span class="header-section-number">4.16</span> Summarise data by groups</h2>
<p>You want to compute and then compare summary statistics for different groups of data in your data set.</p>
<div id="solution-35" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(cases), <span class="dt">max_rate =</span> <span class="kw">max</span>(cases<span class="op">/</span>population))</code></pre>
<pre><code>## # A tibble: 3 x 3
##   country     total_cases max_rate
##   &lt;chr&gt;             &lt;int&gt;    &lt;dbl&gt;
## 1 Afghanistan        3411 0.000129
## 2 Brazil           118225 0.000461
## 3 China            426024 0.000167</code></pre>
</div>
<div id="discussion-32" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>group_by()</code> converts your data set into a grouped tibble, which is a tibble subclass that indicates in its attributes which rows belong to which group.</p>
<p>Where appropriate, tidyverse functions recognize grouped tibbles. The functions:</p>
<ol style="list-style-type: decimal">
<li>treat each group as a distinct data set</li>
<li>execute their code content separately on each group</li>
<li>combine the results in a new data frame that contains a column of group labels (as above).</li>
</ol>
<p>Pass <code>group_by()</code> a column to group by the values of that column (rows that contain the same value will be placed in the same group). Pass <code>group_by()</code> two or more column names to group by the distinct combinations of values in those columns.</p>
<p>As a rule, tidyverse functions will return a result that contains the same grouping criteria as the original grouped tibble. <code>summarise()</code> is an exception: <code>summarise()</code> removes the last column name from the grouping criteria of its result. Because of this, you can call <code>summarise()</code> repeatedly to view progressively higher level summaries:</p>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(country, year) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(cases))</code></pre>
<pre><code>## # A tibble: 6 x 3
## # Groups:   country [?]
##   country      year total_cases
##   &lt;chr&gt;       &lt;int&gt;       &lt;int&gt;
## 1 Afghanistan  1999         745
## 2 Afghanistan  2000        2666
## 3 Brazil       1999       37737
## 4 Brazil       2000       80488
## 5 China        1999      212258
## 6 China        2000      213766</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(country, year) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(cases)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(total_cases))</code></pre>
<pre><code>## # A tibble: 3 x 2
##   country     total_cases
##   &lt;chr&gt;             &lt;int&gt;
## 1 Afghanistan        3411
## 2 Brazil           118225
## 3 China            426024</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(country, year) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(cases)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(total_cases)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(total_cases))</code></pre>
<pre><code>## # A tibble: 1 x 1
##   total_cases
##         &lt;int&gt;
## 1      547660</code></pre>
</div>
</div>
<div id="mutate-data-add-new-variables" class="section level2">
<h2><span class="header-section-number">4.17</span> Mutate data (Add new variables)</h2>
<p>You want to compute one or more new variables and add them to your table as columns.</p>
<div id="solution-36" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rate =</span> cases<span class="op">/</span>population, <span class="dt">percent =</span> rate <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)</code></pre>
<pre><code>## # A tibble: 6 x 6
##   country      year  cases population      rate percent
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 Afghanistan  1999    745   19987071 0.0000373 0.00373
## 2 Afghanistan  2000   2666   20595360 0.000129  0.0129 
## 3 Brazil       1999  37737  172006362 0.000219  0.0219 
## 4 Brazil       2000  80488  174504898 0.000461  0.0461 
## 5 China        1999 212258 1272915272 0.000167  0.0167 
## 6 China        2000 213766 1280428583 0.000167  0.0167</code></pre>
</div>
<div id="discussion-33" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>mutate()</code> returns a copy of your table that contains additional columns. Each argument name passed to <code>mutate()</code> will become the name of a new column. Each new column will contain the result of the R expression passed to the argument/column name.</p>
<p><code>mutate()</code> will build the columns in the order that you define them. As a result, you may use a column in the column definitions that follow it.</p>
<p><code>mutate()</code> is intended to be used with <em>vectorized functions</em>, which are functions that take a vector of values as input and return a new vector of values as output (e.g <code>abs()</code>, <code>round()</code>, and all of R’s math operations).</p>
<p>Use <code>transmute()</code> to return only the new columns that <code>mutate()</code> would create.</p>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">transmute</span>(<span class="dt">rate =</span> cases<span class="op">/</span>population, <span class="dt">percent =</span> rate <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)</code></pre>
<pre><code>## # A tibble: 6 x 2
##        rate percent
##       &lt;dbl&gt;   &lt;dbl&gt;
## 1 0.0000373 0.00373
## 2 0.000129  0.0129 
## 3 0.000219  0.0219 
## 4 0.000461  0.0461 
## 5 0.000167  0.0167 
## 6 0.000167  0.0167</code></pre>
</div>
</div>
<div id="combine-transform-recipes" class="section level2">
<h2><span class="header-section-number">4.18</span> Combine transform recipes</h2>
<p>You want to transform the structure of a table, and you want to use the data within the table to do it. This is the sort of thing you do everytime you call <code>summarise()</code> or <code>mutate()</code>.</p>
<div id="solution-37" class="section level4 unnumbered">
<h4>Solution</h4>
<p>See the discussion.</p>
</div>
<div id="discussion-34" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>When you transform a data frame, you often work with several functions:</p>
<ol style="list-style-type: decimal">
<li><p>A function that transforms the structure of the data frame to add or remove rows or columns. This function transforms a <em>table</em>.</p></li>
<li><p>A function that transforms the values that appear in the data frame to create new values to place in a new row or column. This function transforms a <em>data vector</em>.</p></li>
<li><p>A function that mediates between 1 and 2 if the values are embedded in a list-column, which is a <em>list</em>.</p></li>
</ol>
<p>The most concise way to learn how to combine these functions is to learn about the functions in isolation, and to then have the functions call each other as necessary.</p>
<div id="an-example" class="section level5">
<h5><span class="header-section-number">4.18.0.0.1</span> An Example</h5>
<p><code>smiths</code> contains measurements that describe two fictional people: John and Mary Smith.</p>
<pre class="sourceCode r"><code class="sourceCode r">smiths</code></pre>
<pre><code>## # A tibble: 2 x 5
##   subject     time   age weight height
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 John Smith     1    33     90   1.87
## 2 Mary Smith     1    NA     NA   1.54</code></pre>
<p>To round the <code>height</code> value for each person, you would need two functions:</p>
<ol style="list-style-type: decimal">
<li><code>round()</code> which can round the values of the data vector stored in <code>smiths$height</code>.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">round</span>(smiths<span class="op">$</span>height)</code></pre>
<pre><code>## [1] 2 2</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><code>mutate()</code> which can add the results to a copy of the <code>smiths</code> table.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">smiths <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height_int =</span> <span class="kw">round</span>(height))</code></pre>
<pre><code>## # A tibble: 2 x 6
##   subject     time   age weight height height_int
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 John Smith     1    33     90   1.87          2
## 2 Mary Smith     1    NA     NA   1.54          2</code></pre>
<p><code>round()</code> works with data vectors. <code>mutate()</code> works with tables. Together they create the table you want.</p>
</div>
<div id="an-example-that-uses-list-columns" class="section level5">
<h5><span class="header-section-number">4.18.0.0.2</span> An example that uses list columns</h5>
<p><code>sepals</code> contains sepal length measurements for three species of flower. The measurements are stored in a list-column named <code>lengths</code>.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<pre class="sourceCode r"><code class="sourceCode r">sepals</code></pre>
<pre><code>## # A tibble: 3 x 2
##   Species    lengths   
##   &lt;fct&gt;      &lt;list&gt;    
## 1 setosa     &lt;dbl [50]&gt;
## 2 versicolor &lt;dbl [50]&gt;
## 3 virginica  &lt;dbl [50]&gt;</code></pre>
<p>Each cell in <code>lengths</code> contains a data vector of 50 sepal lengths.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># For example, the first cell of lengths</span>
sepals[[<span class="dv">1</span>, <span class="dv">2</span>]]</code></pre>
<pre><code>##  [1] 5.1 4.9 4.7 4.6 5.0 5.4 4.6 5.0 4.4 4.9 5.4 4.8 4.8 4.3 5.8 5.7 5.4
## [18] 5.1 5.7 5.1 5.4 5.1 4.6 5.1 4.8 5.0 5.0 5.2 5.2 4.7 4.8 5.4 5.2 5.5
## [35] 4.9 5.0 5.5 4.9 4.4 5.1 5.0 4.5 4.4 5.0 5.1 4.8 5.1 4.6 5.3 5.0</code></pre>
<p>To append the average sepal length for each species, you would need three functions:</p>
<ol style="list-style-type: decimal">
<li><p><code>mean()</code> which can compute the average value of a data vector in <code>lengths</code></p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mean</span>(sepals[[<span class="dv">1</span>, <span class="dv">2</span>]])</code></pre>
<pre><code>## [1] 5.006</code></pre></li>
<li><p><code>map_dbl()</code> which can apply <code>mean()</code> to each cell of <code>lengths</code>, which is a list-column.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">map_dbl</span>(sepals<span class="op">$</span>lengths, mean)</code></pre>
<pre><code>## [1] 5.006 5.936 6.588</code></pre></li>
<li><p><code>mutate()</code> which can add the results to a copy of the <code>sepals</code> table.</p>
<pre class="sourceCode r"><code class="sourceCode r">sepals <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">avg_length =</span> <span class="kw">map_dbl</span>(lengths, mean))</code></pre>
<pre><code>## # A tibble: 3 x 3
##   Species    lengths    avg_length
##   &lt;fct&gt;      &lt;list&gt;          &lt;dbl&gt;
## 1 setosa     &lt;dbl [50]&gt;       5.01
## 2 versicolor &lt;dbl [50]&gt;       5.94
## 3 virginica  &lt;dbl [50]&gt;       6.59</code></pre></li>
</ol>
<p><code>mean()</code> works with data vectors. <code>map_dbl()</code> works with list-columns. <code>mutate()</code> works with tables. Together they create the table you want.</p>
</div>
</div>
</div>
<div id="join-data-sets-by-common-columns" class="section level2">
<h2><span class="header-section-number">4.19</span> Join data sets by common column(s)</h2>
<p>You want to combine two data sets into a single data set, taking care to ensure that observations in the first data set are matched to the corresponding observations in the second data set, even if those observations do not appear in the same order.</p>
<p>Your data is structured in such a way that you can match observations by the values of one or more ID columns that appear in both data sets.</p>
<p>For example, you would like to combine <code>band_members</code> and <code>band_insturments</code> into a single data based on the values of the <code>name</code> column. The new data set will correctly list who plays what.</p>
<pre class="sourceCode r"><code class="sourceCode r">band_members</code></pre>
<pre><code>## # A tibble: 3 x 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 Mick  Stones 
## 2 John  Beatles
## 3 Paul  Beatles</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">band_instruments</code></pre>
<pre><code>## # A tibble: 3 x 2
##   name  plays 
##   &lt;chr&gt; &lt;chr&gt; 
## 1 John  guitar
## 2 Paul  bass  
## 3 Keith guitar</code></pre>
<div id="solution-38" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">band_members <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(band_instruments, <span class="dt">by =</span> <span class="st">&quot;name&quot;</span>)</code></pre>
<pre><code>## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass</code></pre>
</div>
<div id="discussion-35" class="section level4 unnumbered">
<h4>Discussion</h4>
<div id="mutating-joins" class="section level5 unnumbered">
<h5>Mutating joins</h5>
<p>You have four options when joining content from one data set to another. Of these, <code>left_join()</code> is the most frequently used.</p>
<ol style="list-style-type: decimal">
<li><p><code>left_join()</code> returns a copy of the first data set that includes any rows from the second data set that have a match in the first data set, ignoring the rows that do not have a match (as above).</p></li>
<li><p><code>right_join()</code> returns a copy of the second data set intermixed with any rows from the first data set that have a match in the second data set, ignoring the rows that do not have a match:</p>
<pre class="sourceCode r"><code class="sourceCode r">band_members <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">right_join</span>(band_instruments, <span class="dt">by =</span> <span class="st">&quot;name&quot;</span>)</code></pre>
<pre><code>## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 John  Beatles guitar
## 2 Paul  Beatles bass  
## 3 Keith &lt;NA&gt;    guitar</code></pre></li>
<li><p><code>inner_join()</code> returns a copy of those rows in the first data set that have a match in the second data set along with the rows from the second data set that they match. <code>inner_join()</code> does not retain any incomplete rows from either data set.</p>
<pre class="sourceCode r"><code class="sourceCode r">band_members <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(band_instruments, <span class="dt">by =</span> <span class="st">&quot;name&quot;</span>)</code></pre>
<pre><code>## # A tibble: 2 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 John  Beatles guitar
## 2 Paul  Beatles bass</code></pre></li>
<li><p><code>full_join()</code> returns a copy of the first data set that includes every row from the second data set. <code>full_join()</code> includes all of the data from each data set.</p>
<pre class="sourceCode r"><code class="sourceCode r">band_members <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">full_join</span>(band_instruments, <span class="dt">by =</span> <span class="st">&quot;name&quot;</span>)</code></pre>
<pre><code>## # A tibble: 4 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass  
## 4 Keith &lt;NA&gt;    guitar</code></pre></li>
</ol>
<p><code>left_join()</code>, <code>right_join()</code>, <code>inner_join()</code>, and <code>full_join()</code> are collectively called <em>mutating joins</em> because they add additional columns to a copy of a data set, as does <code>mutate()</code>.</p>
</div>
<div id="specifying-columns-to-join-on" class="section level5 unnumbered">
<h5>Specifying column(s) to join on</h5>
<p>Pass the <code>by</code> argument the name of the column to join on as a character string. This name should appear in both data sets.</p>
<p>To join on multiple columns, pass <code>by</code> a character vector of column names. Each name should appear in both data sets. R will join together rows that contain the same combination of values in the columns.</p>
<pre class="sourceCode r"><code class="sourceCode r">table1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(table3, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</code></pre>
<pre><code>## # A tibble: 6 x 5
##   country      year  cases population rate             
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999    745   19987071 745/19987071     
## 2 Afghanistan  2000   2666   20595360 2666/20595360    
## 3 Brazil       1999  37737  172006362 37737/172006362  
## 4 Brazil       2000  80488  174504898 80488/174504898  
## 5 China        1999 212258 1272915272 212258/1272915272
## 6 China        2000 213766 1280428583 213766/1280428583</code></pre>
<p>If you do not provide a <code>by</code> argument, the mutating join functions will join on the set of column names that appear in both data sets.</p>
</div>
<div id="joining-when-id-names-do-not-match" class="section level5 unnumbered">
<h5>Joining when ID names do not match</h5>
<p>It is common for an ID column to appear with different names in each data set. For example, the <code>name</code> column appears as <code>artist</code> in <code>band_instruments2</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">band_instruments2</code></pre>
<pre><code>## # A tibble: 3 x 2
##   artist plays 
##   &lt;chr&gt;  &lt;chr&gt; 
## 1 John   guitar
## 2 Paul   bass  
## 3 Keith  guitar</code></pre>
<p>To join by two columns that have different names, pass <code>by</code> a named character vector. For each element in the vector, the mutating join will match the column in the first data set that corresponds to the name of the element to the column in the data set that corresponds to the value of the argument.</p>
<pre class="sourceCode r"><code class="sourceCode r">band_members <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(band_instruments2, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">name =</span> <span class="st">&quot;artist&quot;</span>))</code></pre>
<pre><code>## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass</code></pre>
<p>R will use the column name(s) from the first data set in the result.</p>
</div>
<div id="suffixes" class="section level5 unnumbered">
<h5>Suffixes</h5>
<p>The mutating joins will append the suffixes <code>.x</code> and <code>.y</code> to any columns that are not used to join on, but have the same name in both data sets. The columns from the first data set are suffixed with <code>.x</code>, the columns from the second with <code>.y</code>.</p>
<pre class="sourceCode r"><code class="sourceCode r">table4a <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(table4b, <span class="dt">by =</span> <span class="st">&quot;country&quot;</span>)</code></pre>
<pre><code>## # A tibble: 3 x 5
##   country     `1999.x` `2000.x`   `1999.y`   `2000.y`
##   &lt;chr&gt;          &lt;int&gt;    &lt;int&gt;      &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan      745     2666   19987071   20595360
## 2 Brazil         37737    80488  172006362  174504898
## 3 China         212258   213766 1272915272 1280428583</code></pre>
<p>To use different suffixes, supply a character vector of length two as a <code>suffix</code> argument.</p>
<pre class="sourceCode r"><code class="sourceCode r">table4a <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(table4b, <span class="dt">by =</span> <span class="st">&quot;country&quot;</span>, <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;_cases&quot;</span>, <span class="st">&quot;_pop&quot;</span>))</code></pre>
<pre><code>## # A tibble: 3 x 5
##   country     `1999_cases` `2000_cases` `1999_pop` `2000_pop`
##   &lt;chr&gt;              &lt;int&gt;        &lt;int&gt;      &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan          745         2666   19987071   20595360
## 2 Brazil             37737        80488  172006362  174504898
## 3 China             212258       213766 1272915272 1280428583</code></pre>
</div>
</div>
</div>
<div id="filter-one-data-set-against-another" class="section level2">
<h2><span class="header-section-number">4.20</span> Filter one data set against another</h2>
<p>You want to filter a data set down to only the rows that <em>have</em> a corresponding row in a second set, or alternatively to only the rows that <em>do not have</em> a corresponding row in a second data set.</p>
<p>Your data is structured in such a way that you can match rows by the values of one or more ID columns that appear in both data sets.</p>
<p>For example, you would like to return the rows of <code>band_members</code> that have a corresponding row in <code>band_instruments</code>. The new data set will be a reduced version of <code>band_members</code> that does not contain any new columns.</p>
<pre class="sourceCode r"><code class="sourceCode r">band_members</code></pre>
<pre><code>## # A tibble: 3 x 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 Mick  Stones 
## 2 John  Beatles
## 3 Paul  Beatles</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">band_instruments</code></pre>
<pre><code>## # A tibble: 3 x 2
##   name  plays 
##   &lt;chr&gt; &lt;chr&gt; 
## 1 John  guitar
## 2 Paul  bass  
## 3 Keith guitar</code></pre>
<div id="solution-39" class="section level4 unnumbered">
<h4>Solution</h4>
<pre class="sourceCode r"><code class="sourceCode r">band_members <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">semi_join</span>(band_instruments, <span class="dt">by =</span> <span class="st">&quot;name&quot;</span>)</code></pre>
<pre><code>## # A tibble: 2 x 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 John  Beatles
## 2 Paul  Beatles</code></pre>
</div>
<div id="discussion-36" class="section level4 unnumbered">
<h4>Discussion</h4>
<div id="filtering-joins" class="section level5 unnumbered">
<h5>Filtering joins</h5>
<p>You have two options when filtering one data against another.</p>
<ol style="list-style-type: decimal">
<li><p><code>semi_join()</code> returns a copy of the first data set that includes only the rows that <em>have</em> a corresponding row in the second data set.</p></li>
<li><p><code>anti_join()</code> returns a copy of the first data set that includes only the rows that <em>do not have</em> a corresponding row in the second data set.</p>
<pre class="sourceCode r"><code class="sourceCode r">band_members <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">anti_join</span>(band_instruments, <span class="dt">by =</span> <span class="st">&quot;name&quot;</span>)</code></pre>
<pre><code>## # A tibble: 1 x 2
##   name  band  
##   &lt;chr&gt; &lt;chr&gt; 
## 1 Mick  Stones</code></pre>
<p><code>anti_join()</code> provides a useful way to check for typos that could interfere with a mutating join; these rows will not have a match in the second data set (assuming that the typo does not also appear in the second data set).</p>
<p><code>anti_join()</code> also highlihts entries that are coded in different ways across data sets, such as <code>&quot;North_Carolina&quot;</code> and <code>&quot;North Carolina&quot;</code>.</p></li>
</ol>
<p><code>semi_join()</code> and <code>anti_join()</code> are collectively called <em>filtering joins</em> because they filter a data set to only those rows that meet a specific criteria, as does <code>filter()</code>.</p>
<p>Filtering joins can be more effective than <code>filter()</code> when you need to filter on a complicated set of conditions: use <code>tribble()</code> to create a data set to filter against.</p>
<p>Unlike mutating joins, filtering joins do not add columns from the second data set to the first. They only use the second data set to identify rows to return from the first.</p>
</div>
<div id="specifying-columns-to-join-on-1" class="section level5 unnumbered">
<h5>Specifying column(s) to join on</h5>
<p>Filtering joins use the same <code>by</code> syntax as mutating joins. Learn more in <a href="transform-tables.html#specifying-columns-to-join-on-1">Specifying column(s) to join on</a> and <a href="transform-tables.html#joining-when-id-names-do-not-match">Joining when ID names do not match</a>.</p>

</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>I made this data frame with the code <code>sepals &lt;- iris %&gt;%    group_by(Species) %&gt;%    summarise(lengths = list(Sepal.Length))</code><a href="transform-tables.html#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tidy.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="transform-lists.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio-education/tidyverse-cookbook/edit/master/04-transform-tables.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>

<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Transform Tables | The Tidyverse Cookbook</title>
  <meta name="description" content="How to solve common data science tasks with R’s Tidyverse" />
  <meta name="generator" content="bookdown 0.20.1 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Transform Tables | The Tidyverse Cookbook" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="How to solve common data science tasks with R’s Tidyverse" />
  <meta name="github-repo" content="rstudio-education/tidyverse-cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Transform Tables | The Tidyverse Cookbook" />
  
  <meta name="twitter:description" content="How to solve common data science tasks with R’s Tidyverse" />
  

<meta name="author" content="Edited by Garrett Grolemund" />


<meta name="date" content="2020-07-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tidy.html"/>
<link rel="next" href="transform-lists-and-vectors.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Tidyverse Cookbook</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="how-to-use-this-book.html"><a href="how-to-use-this-book.html"><i class="fa fa-check"></i>How to use this book</a></li>
<li class="part"><span><b>I The Recipes</b></span></li>
<li class="chapter" data-level="1" data-path="program.html"><a href="program.html"><i class="fa fa-check"></i><b>1</b> Program</a></li>
<li class="chapter" data-level="2" data-path="import.html"><a href="import.html"><i class="fa fa-check"></i><b>2</b> Import</a></li>
<li class="chapter" data-level="3" data-path="tidy.html"><a href="tidy.html"><i class="fa fa-check"></i><b>3</b> Tidy</a></li>
<li class="chapter" data-level="4" data-path="transform-tables.html"><a href="transform-tables.html"><i class="fa fa-check"></i><b>4</b> Transform Tables</a></li>
<li class="chapter" data-level="5" data-path="transform-lists-and-vectors.html"><a href="transform-lists-and-vectors.html"><i class="fa fa-check"></i><b>5</b> Transform Lists and Vectors</a></li>
<li class="chapter" data-level="6" data-path="transform-strings.html"><a href="transform-strings.html"><i class="fa fa-check"></i><b>6</b> Transform Strings</a></li>
<li class="chapter" data-level="7" data-path="transform-factors.html"><a href="transform-factors.html"><i class="fa fa-check"></i><b>7</b> Transform Factors</a></li>
<li class="chapter" data-level="8" data-path="transform-dates-and-times.html"><a href="transform-dates-and-times.html"><i class="fa fa-check"></i><b>8</b> Transform Dates and Times</a></li>
<li class="chapter" data-level="9" data-path="visualize-data.html"><a href="visualize-data.html"><i class="fa fa-check"></i><b>9</b> Visualize Data</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Tidyverse Cookbook</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="transform-tables" class="section level1">
<h1><span class="header-section-number">4</span> Transform Tables</h1>
<hr />
<p>This chapter includes the following recipes:</p>
<div class="col2">
<ol style="list-style-type: decimal">
<li><a href="transform-tables.html#arrange-rows-by-value-in-ascending-order">Arrange rows by value in ascending order</a></li>
<li><a href="transform-tables.html#arrange-rows-by-value-in-descending-order">Arrange rows by value in descending order</a></li>
<li><a href="transform-tables.html#filter-rows-with-a-logical-test">Filter rows with a logical test</a></li>
<li><a href="transform-tables.html#select-columns-by-name">Select columns by name</a></li>
<li><a href="transform-tables.html#drop-columns-by-name">Drop columns by name</a></li>
<li><a href="transform-tables.html#select-a-range-of-columns">Select a range of columns</a></li>
<li><a href="transform-tables.html#select-columns-by-integer-position">Select columns by integer position</a></li>
<li><a href="transform-tables.html#select-columns-by-start-of-name">Select columns by start of name</a></li>
<li><a href="transform-tables.html#select-columns-by-end-of-name">Select columns by end of name</a></li>
<li><a href="transform-tables.html#select-columns-by-string-in-name">Select columns by string in name</a></li>
<li><a href="transform-tables.html#reorder-columns">Reorder columns</a></li>
<li><a href="transform-tables.html#reorder-columns-without-naming-each">Reorder columns without naming each</a></li>
<li><a href="transform-tables.html#rename-columns">Rename columns</a></li>
<li><a href="transform-tables.html#return-the-contents-of-a-column-as-a-vector">Return the contents of a column as a vector</a></li>
<li><a href="transform-tables.html#mutate-data-add-new-variables">Mutate data (Add new variables)</a></li>
<li><a href="transform-tables.html#summarise-data">Summarise data</a></li>
<li><a href="transform-tables.html#group-data">Group data</a></li>
<li><a href="transform-tables.html#summarise-data-by-groups">Summarise data by groups</a></li>
<li><a href="transform-tables.html#nest-a-data-frame">Nest a data frame</a></li>
<li><a href="transform-tables.html#extract-a-table-from-a-nested-data-frame">Extract a table from a nested data frame</a></li>
<li><a href="transform-tables.html#unnest-a-data-frame">Unnest a data frame</a></li>
<li><a href="transform-tables.html#combine-transform-recipes">Combine transform recipes</a></li>
<li><a href="transform-tables.html#joins">Join data sets by common column(s)</a></li>
<li><a href="transform-tables.html#find-rows-that-have-a-match-in-another-data-set">Find rows that have a match in another data set</a></li>
<li><a href="transform-tables.html#find-rows-that-do-not-have-a-match-in-another-data-set">Find rows that do not have a match in another data set</a></li>
</ol>
</div>
<hr />
<div id="what-you-should-know-before-you-begin" class="section level2 unnumbered">
<h2>What you should know before you begin</h2>

<div class="rmdcaution">
<p>The dplyr package provides the most important tidyverse functions for manipulating tables. These functions share some defaults that make it easy to transform tables:</p>
<ol style="list-style-type: decimal">
<li><p>dplyr functions always return a transformed <em>copy</em> of your table. They won’t change your original table unless you tell them to (by saving over the name of the original table). That’s good news, because you should always retain a clean copy of your original data in case something goes wrong.</p></li>
<li><p>You can refer to columns by name inside of a dplyr function. There’s no need for <code>$</code> syntax or <code>&quot;&quot;</code>. Every dplyr function requires you to supply a data frame, and it will recognize the columns in that data frame, e.g.</p>
<p><code>summarise(mpg, h = mean(hwy), c = mean(cty))</code></p>
<p>This only becomes a problem if you’d like to use an object that has the same name as one of the columns in the data frame. In this case, place <code>!!</code> before the object’s name to unquote it, dplyr will skip the columns when looking up the object. e.g.</p>
<p><code>hwy &lt;- 1:10</code><br />
<code>summarise(mpg, h = mean(!!hwy), c = mean(cty))</code></p></li>
</ol>
<p>Transforming a table sometimes requires more than one recipe. Why? Because tables are made of multiple data structures that work together:</p>
<ol style="list-style-type: decimal">
<li>The table itself is a data frame or tibble.<br />
</li>
<li>The columns of the table are vectors.<br />
</li>
<li>Some columns may be list-columns, which are lists that contain vectors.</li>
</ol>
<p>Each tidyverse function tends to focus on a single type of data structure; it is part of the tidyverse philosophy that each function should do one thing and do it well.</p>
So to transform a table, begin with a recipe that transforms the structure of the table. You’ll find those recipes in this chapter. Then complete it with a recipe that transforms the actual data values in your table. The <a href="transform-tables.html#combine-transform-recipes">Combine transform recipes</a> recipe will show you how.
</div>

</div>
<div id="arrange-rows-by-value-in-ascending-order" class="section level2">
<h2><span class="header-section-number">4.1</span> Arrange rows by value in ascending order</h2>
<p>You want to sort the rows of a data frame in <strong>ascending</strong> order by the values in one or more columns.</p>
<p><img src="images/dplyr-arrange.png" style="display: block; margin: auto;" /></p>
<div id="solution" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">mpg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(displ)</a></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model   displ  year   cyl trans   drv     cty   hwy fl    class 
##    &lt;chr&gt;        &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 honda        civic     1.6  1999     4 manual… f        28    33 r     subco…
##  2 honda        civic     1.6  1999     4 auto(l… f        24    32 r     subco…
##  3 honda        civic     1.6  1999     4 manual… f        25    32 r     subco…
##  4 honda        civic     1.6  1999     4 manual… f        23    29 p     subco…
##  5 honda        civic     1.6  1999     4 auto(l… f        24    32 r     subco…
##  6 audi         a4        1.8  1999     4 auto(l… f        18    29 p     compa…
##  7 audi         a4        1.8  1999     4 manual… f        21    29 p     compa…
##  8 audi         a4 qua…   1.8  1999     4 manual… 4        18    26 p     compa…
##  9 audi         a4 qua…   1.8  1999     4 auto(l… 4        16    25 p     compa…
## 10 honda        civic     1.8  2008     4 manual… f        26    34 r     subco…
## # … with 224 more rows</code></pre>
</div>
<div id="discussion" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>arrange()</code> sorts the rows according to the values of the specified column, with the lowest values appearing near the top of the data frame. If you provide additional column names, <code>arrange()</code> will use the additional columns in order as tiebreakers to sort within rows that share the same value of the first column.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">mpg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb74-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(displ, cty)</a></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model   displ  year   cyl trans   drv     cty   hwy fl    class 
##    &lt;chr&gt;        &lt;chr&gt;   &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
##  1 honda        civic     1.6  1999     4 manual… f        23    29 p     subco…
##  2 honda        civic     1.6  1999     4 auto(l… f        24    32 r     subco…
##  3 honda        civic     1.6  1999     4 auto(l… f        24    32 r     subco…
##  4 honda        civic     1.6  1999     4 manual… f        25    32 r     subco…
##  5 honda        civic     1.6  1999     4 manual… f        28    33 r     subco…
##  6 audi         a4 qua…   1.8  1999     4 auto(l… 4        16    25 p     compa…
##  7 audi         a4        1.8  1999     4 auto(l… f        18    29 p     compa…
##  8 audi         a4 qua…   1.8  1999     4 manual… 4        18    26 p     compa…
##  9 volkswagen   passat    1.8  1999     4 auto(l… f        18    29 p     midsi…
## 10 audi         a4        1.8  1999     4 manual… f        21    29 p     compa…
## # … with 224 more rows</code></pre>
</div>
</div>
<div id="arrange-rows-by-value-in-descending-order" class="section level2">
<h2><span class="header-section-number">4.2</span> Arrange rows by value in descending order</h2>
<p>You want to sort the rows of a data frame in <strong>descending</strong> order by the values in one or more columns.</p>
<p><img src="images/dplyr-desc.png" style="display: block; margin: auto;" /></p>
<div id="solution-1" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1">mpg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb76-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(displ))</a></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model     displ  year   cyl trans  drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 chevrolet    corvette    7    2008     8 manua… r        15    24 p     2sea…
##  2 chevrolet    k1500 ta…   6.5  1999     8 auto(… 4        14    17 d     suv  
##  3 chevrolet    corvette    6.2  2008     8 manua… r        16    26 p     2sea…
##  4 chevrolet    corvette    6.2  2008     8 auto(… r        15    25 p     2sea…
##  5 jeep         grand ch…   6.1  2008     8 auto(… 4        11    14 p     suv  
##  6 chevrolet    c1500 su…   6    2008     8 auto(… r        12    17 r     suv  
##  7 dodge        durango …   5.9  1999     8 auto(… 4        11    15 r     suv  
##  8 dodge        ram 1500…   5.9  1999     8 auto(… 4        11    15 r     pick…
##  9 chevrolet    c1500 su…   5.7  1999     8 auto(… r        13    17 r     suv  
## 10 chevrolet    corvette    5.7  1999     8 manua… r        16    26 p     2sea…
## # … with 224 more rows</code></pre>
</div>
<div id="discussion-1" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>Place <code>desc()</code> around a column name to cause <code>arrange()</code> to sort by descending values of that column. You can use <code>desc()</code> for tie-breaker columns as well (compare line nine below to the table above).</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1">mpg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb78-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(displ), <span class="kw">desc</span>(cty))</a></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model     displ  year   cyl trans  drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;  &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 chevrolet    corvette    7    2008     8 manua… r        15    24 p     2sea…
##  2 chevrolet    k1500 ta…   6.5  1999     8 auto(… 4        14    17 d     suv  
##  3 chevrolet    corvette    6.2  2008     8 manua… r        16    26 p     2sea…
##  4 chevrolet    corvette    6.2  2008     8 auto(… r        15    25 p     2sea…
##  5 jeep         grand ch…   6.1  2008     8 auto(… 4        11    14 p     suv  
##  6 chevrolet    c1500 su…   6    2008     8 auto(… r        12    17 r     suv  
##  7 dodge        durango …   5.9  1999     8 auto(… 4        11    15 r     suv  
##  8 dodge        ram 1500…   5.9  1999     8 auto(… 4        11    15 r     pick…
##  9 chevrolet    corvette    5.7  1999     8 manua… r        16    26 p     2sea…
## 10 chevrolet    corvette    5.7  1999     8 auto(… r        15    23 p     2sea…
## # … with 224 more rows</code></pre>
</div>
</div>
<div id="filter-rows-with-a-logical-test" class="section level2">
<h2><span class="header-section-number">4.3</span> Filter rows with a logical test</h2>
<p>You want to filter your table to just the rows that meet a specific condition.</p>
<p><img src="images/dplyr-filter.png" style="display: block; margin: auto;" /></p>
<div id="solution-2" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1">mpg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(model <span class="op">==</span><span class="st"> &quot;jetta&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 9 x 11
##   manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class 
##   &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 volkswagen   jetta   1.9  1999     4 manual(m5) f        33    44 d     compa…
## 2 volkswagen   jetta   2    1999     4 manual(m5) f        21    29 r     compa…
## 3 volkswagen   jetta   2    1999     4 auto(l4)   f        19    26 r     compa…
## 4 volkswagen   jetta   2    2008     4 auto(s6)   f        22    29 p     compa…
## 5 volkswagen   jetta   2    2008     4 manual(m6) f        21    29 p     compa…
## 6 volkswagen   jetta   2.5  2008     5 auto(s6)   f        21    29 r     compa…
## 7 volkswagen   jetta   2.5  2008     5 manual(m5) f        21    29 r     compa…
## 8 volkswagen   jetta   2.8  1999     6 auto(l4)   f        16    23 r     compa…
## 9 volkswagen   jetta   2.8  1999     6 manual(m5) f        17    24 r     compa…</code></pre>
</div>
<div id="discussion-2" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>filter()</code> takes a logical test and returns the rows for which the logical test returns <code>TRUE</code>. <code>filter()</code> will match column names that appear within the logical test to columns in your data frame.</p>
<p>If you provide multiple logical tests, <code>filter()</code> will combine them with an AND operator (<code>&amp;</code>):</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1">mpg <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb82-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(model <span class="op">==</span><span class="st"> &quot;jetta&quot;</span>, year <span class="op">==</span><span class="st"> </span><span class="dv">1999</span>)</a></code></pre></div>
<p>Use R’s boolean operators, like <code>|</code>and <code>!</code>, to create other combinations of logical tests to pass to filter. See the help pages for <code>?Comparison</code> and <code>?Logic</code> to learn more about writing logical tests in R.</p>
</div>
</div>
<div id="select-columns-by-name" class="section level2">
<h2><span class="header-section-number">4.4</span> Select columns by name</h2>
<p>You want to return a “subset” of columns from your data frame by listing the name of each column to return.</p>
<p><img src="images/dplyr-select.png" style="display: block; margin: auto;" /></p>
<div id="solution-3" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(country, year, cases)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year  cases
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan  1999    745
## 2 Afghanistan  2000   2666
## 3 Brazil       1999  37737
## 4 Brazil       2000  80488
## 5 China        1999 212258
## 6 China        2000 213766</code></pre>
<!-- I couldn't find table1 anywhere in a search, may want to provide code for people at the top to generate? Or at least cross-reference -->
</div>
<div id="discussion-3" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>select()</code> returns a new data frame that includes each column passed to <code>select()</code>. Repeat a name to include the column twice.</p>
</div>
</div>
<div id="drop-columns-by-name" class="section level2">
<h2><span class="header-section-number">4.5</span> Drop columns by name</h2>
<p>You want to return a “subset” of columns from your data frame by listing the name of each column to drop.</p>
<p><img src="images/dplyr-select-drop.png" style="display: block; margin: auto;" /></p>
<div id="solution-4" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(population, year))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   country      cases
##   &lt;chr&gt;        &lt;int&gt;
## 1 Afghanistan    745
## 2 Afghanistan   2666
## 3 Brazil       37737
## 4 Brazil       80488
## 5 China       212258
## 6 China       213766</code></pre>
</div>
<div id="discussion-4" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>If you use a <code>-</code> before a column name, <code>select()</code> will return every column in the data frame except that column. To drop more than one column at a time, group the columns into a vector preceded by <code>-</code>.</p>
</div>
</div>
<div id="select-a-range-of-columns" class="section level2">
<h2><span class="header-section-number">4.6</span> Select a range of columns</h2>
<p>You want to return two columns from a data frame as well as every column that appears between them.</p>
<p><img src="images/dplyr-select-range.png" style="display: block; margin: auto;" /></p>
<div id="solution-5" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(country<span class="op">:</span>cases)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year  cases
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan  1999    745
## 2 Afghanistan  2000   2666
## 3 Brazil       1999  37737
## 4 Brazil       2000  80488
## 5 China        1999 212258
## 6 China        2000 213766</code></pre>
</div>
<div id="discussion-5" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>If you combine two column names with a <code>:</code>, <code>select()</code> will return both columns and every column that appears between them in the data frame.</p>
</div>
</div>
<div id="select-columns-by-integer-position" class="section level2">
<h2><span class="header-section-number">4.7</span> Select columns by integer position</h2>
<p>You want to return a “subset” of columns from your data frame by listing the position of each column to return.</p>
<div id="solution-6" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb89-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year population
##   &lt;chr&gt;       &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999   19987071
## 2 Afghanistan  2000   20595360
## 3 Brazil       1999  172006362
## 4 Brazil       2000  174504898
## 5 China        1999 1272915272
## 6 China        2000 1280428583</code></pre>
</div>
<div id="discussion-6" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>select()</code> interprets the whole number <em>n</em> as the _n_th column in the data set. You can combine numbers with <code>-</code> and <code>:</code> inside of <code>select()</code> as well.</p>
</div>
</div>
<div id="select-columns-by-start-of-name" class="section level2">
<h2><span class="header-section-number">4.8</span> Select columns by start of name</h2>
<p>You want to return evey column in your data that begins with a specific string.</p>
<div id="solution-7" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb91-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&quot;c&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   country      cases
##   &lt;chr&gt;        &lt;int&gt;
## 1 Afghanistan    745
## 2 Afghanistan   2666
## 3 Brazil       37737
## 4 Brazil       80488
## 5 China       212258
## 6 China       213766</code></pre>
</div>
</div>
<div id="select-columns-by-end-of-name" class="section level2">
<h2><span class="header-section-number">4.9</span> Select columns by end of name</h2>
<p>You want to return evey column in your data that ends with a specific string.</p>
<div id="solution-8" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&quot;tion&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 1
##   population
##        &lt;int&gt;
## 1   19987071
## 2   20595360
## 3  172006362
## 4  174504898
## 5 1272915272
## 6 1280428583</code></pre>
</div>
</div>
<div id="select-columns-by-string-in-name" class="section level2">
<h2><span class="header-section-number">4.10</span> Select columns by string in name</h2>
<p>You want to return evey column in your data whose name contains a specific string or regular expression.</p>
<div id="solution-9" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb95-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="kw">matches</span>(<span class="st">&quot;o.*u&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##   country     population
##   &lt;chr&gt;            &lt;int&gt;
## 1 Afghanistan   19987071
## 2 Afghanistan   20595360
## 3 Brazil       172006362
## 4 Brazil       174504898
## 5 China       1272915272
## 6 China       1280428583</code></pre>
</div>
<div id="discussion-7" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>o.*u</code> is a regular expression that matches an <code>o</code> followed by a <code>u</code> with any number of characters in between. <code>country</code> and <code>population</code> are returned because the names <code>country</code> and <code>population</code> each contain an <code>o</code> followed (at any distance) by a <code>u</code>.</p>
<p>See the help page for <code>?regex</code> to learn more about regular expressions in R.</p>
</div>
</div>
<div id="reorder-columns" class="section level2">
<h2><span class="header-section-number">4.11</span> Reorder columns</h2>
<p>You want to return all of the columns in the original data frame in a new order.</p>
<p><img src="images/dplyr-select-reorder.png" style="display: block; margin: auto;" /></p>
<div id="solution-10" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb97-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(country, year, population, cases)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year population  cases
##   &lt;chr&gt;       &lt;int&gt;      &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan  1999   19987071    745
## 2 Afghanistan  2000   20595360   2666
## 3 Brazil       1999  172006362  37737
## 4 Brazil       2000  174504898  80488
## 5 China        1999 1272915272 212258
## 6 China        2000 1280428583 213766</code></pre>
</div>
<div id="discussion-8" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>Use <code>select()</code> to select all of the columns. List the column names in the new order.</p>
</div>
</div>
<div id="reorder-columns-without-naming-each" class="section level2">
<h2><span class="header-section-number">4.12</span> Reorder columns without naming each</h2>
<p>You want to reorder some of the columns in the original data frame, but you don’t care about the order for other columns, and you may have too many columns to name them each individually.</p>
<p><img src="images/dplyr-select-everything.png" style="display: block; margin: auto;" /></p>
<div id="solution-11" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(country, year, <span class="kw">everything</span>())</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
</div>
<div id="discussion-9" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>Use <code>everything()</code> within <code>select()</code> to select all of the columns in the order they are named: all columns are kept, and no columns are duplicated. Using <code>everything()</code> preserves the original ordering of the original (unnamed) columns.</p>
</div>
</div>
<div id="rename-columns" class="section level2">
<h2><span class="header-section-number">4.13</span> Rename columns</h2>
<p>You want to rename one or more columns in your data frame, retaining the rest.</p>
<p><img src="images/dplyr-rename.png" style="display: block; margin: auto;" /></p>
<div id="solution-12" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb101-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">state =</span> country, <span class="dt">date =</span> year)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   state        date  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
</div>
<div id="discussion-10" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>For each column to be renamed, type a new name for the column and set it equal to the old name for the column.</p>
</div>
</div>
<div id="return-the-contents-of-a-column-as-a-vector" class="section level2">
<h2><span class="header-section-number">4.14</span> Return the contents of a column as a vector</h2>
<p>You want to return the contents of a single column as a vector, not as a data frame with one column.</p>
<p><img src="images/dplyr-pull.png" style="display: block; margin: auto;" /></p>
<div id="solution-13" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb103-2" data-line-number="2"><span class="st">  </span><span class="kw">pull</span>(cases)</a></code></pre></div>
<pre><code>## [1]    745   2666  37737  80488 212258 213766</code></pre>
</div>
<div id="discussion-11" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>pull()</code> comes in the dplyr package. It does the equivalent of <code>pluck()</code> in the purrr package; however, <code>pull()</code> is designed to work specifically with data frames. <code>pluck()</code> is designed to work with all types of lists.</p>
<p>You can also pull a column by integer position:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb105-2" data-line-number="2"><span class="st">  </span><span class="kw">pull</span>(<span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1]    745   2666  37737  80488 212258 213766</code></pre>
</div>
</div>
<div id="mutate-data-add-new-variables" class="section level2">
<h2><span class="header-section-number">4.15</span> Mutate data (Add new variables)</h2>
<p>You want to compute one or more new variables and add them to your table as columns.</p>
<p><img src="images/dplyr-mutate.png" style="display: block; margin: auto;" /></p>
<div id="solution-14" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb107-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rate =</span> cases<span class="op">/</span>population, <span class="dt">percent =</span> rate <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   country      year  cases population      rate percent
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 Afghanistan  1999    745   19987071 0.0000373 0.00373
## 2 Afghanistan  2000   2666   20595360 0.000129  0.0129 
## 3 Brazil       1999  37737  172006362 0.000219  0.0219 
## 4 Brazil       2000  80488  174504898 0.000461  0.0461 
## 5 China        1999 212258 1272915272 0.000167  0.0167 
## 6 China        2000 213766 1280428583 0.000167  0.0167</code></pre>
</div>
<div id="discussion-12" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>To use <code>mutate()</code>, pass it a series of names followed by R expressions. <code>mutate()</code> will return a copy of your table that contains one column for each name that you pass to <code>mutate()</code>. The name of the column will be the name that you passed to <code>mutate()</code>; the contents of the column will be the result of the R expression that you assigned to the name. The R expression should always return a vector of the same length as the other columns in the data frame,<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> because <code>mutate()</code> will add the vector as a new column.</p>
<p><img src="images/dplyr-vectorized-functions.png" style="display: block; margin: auto;" /></p>
<p>In other words, <code>mutate()</code> is intended to be used with <em>vectorized functions</em>, which are functions that take a vector of values as input and return a new vector of values as output (e.g <code>abs()</code>, <code>round()</code>, and all of R’s math operations).</p>
<p><code>mutate()</code> will build the columns in the order that you define them. As a result, you may use a new column in the column definitions that follow it.</p>
<div id="dropping-the-original-data" class="section level5 unnumbered">
<h5>Dropping the original data</h5>
<p>Use <code>transmute()</code> to return only the new columns that <code>mutate()</code> would create.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb109-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">rate =</span> cases<span class="op">/</span>population, <span class="dt">percent =</span> rate <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##        rate percent
##       &lt;dbl&gt;   &lt;dbl&gt;
## 1 0.0000373 0.00373
## 2 0.000129  0.0129 
## 3 0.000219  0.0219 
## 4 0.000461  0.0461 
## 5 0.000167  0.0167 
## 6 0.000167  0.0167</code></pre>
</div>
</div>
</div>
<div id="summarise-data" class="section level2">
<h2><span class="header-section-number">4.16</span> Summarise data</h2>
<p>You want to compute summary statistics for the data in your data frame.</p>
<p><img src="images/dplyr-summarise.png" style="display: block; margin: auto;" /></p>
<div id="solution-15" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb111-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(cases), <span class="dt">max_rate =</span> <span class="kw">max</span>(cases<span class="op">/</span>population))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   total_cases max_rate
##         &lt;int&gt;    &lt;dbl&gt;
## 1      547660 0.000461</code></pre>
</div>
<div id="discussion-13" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>To use <code>summarise()</code>, pass it a series of names followed by R expressions. <code>summarise()</code> will return a new tibble that contains one column for each name that you pass to <code>summarise()</code>. The name of the column will be the name that you passed to <code>summarise()</code>; the contents of the column will be the result of the R expression that you assigned to the name. The R expression should always return a single value because <code>summarise()</code> will always return a 1 x n tibble.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p><img src="images/dplyr-summary-functions.png" style="display: block; margin: auto;" /></p>
<p>In other words, <code>summarise()</code> is intended to be used with <em>summary functions</em>, which are functions that take a vector of values as input and return a single value as output (e.g <code>sum()</code>, <code>max()</code>, <code>mean()</code>). In normal use, <code>summarise()</code> will pass each function a column (i.e. vector) of values and expect a single value in return.</p>
<p><code>summarize()</code> is an alias for <code>summarise()</code>.</p>
</div>
</div>
<div id="group-data" class="section level2">
<h2><span class="header-section-number">4.17</span> Group data</h2>
<p>You want to assign the rows of your data to subgroups based on their shared values or their shared combinations of values.</p>
<p><img src="images/dplyr-groups.png" style="display: block; margin: auto;" /></p>
<p>You want to do this as the first step in a multi-step analysis, because grouping data doesn’t do anything noticeable until you pass the grouped data to a tidyverse function.</p>
<div id="solution-16" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb113-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
## # Groups:   country [3]
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
</div>
<div id="discussion-14" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>group_by()</code> converts your data into a grouped tibble, which is a tibble subclass that indicates in its attributes<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> which rows belong to which group.</p>
<p>To group rows by the values of a single column, pass <code>group_by()</code> a single column name. To group rows by the unique <em>combination</em> of values across multiple columns, pass <code>group_by()</code> the names of two or more columns.</p>
<div id="group-wise-operations" class="section level5 unnumbered">
<h5>Group-wise operations</h5>
<p>Where appropriate, tidyverse functions recognize grouped tibbles. Tidyverse functions:</p>
<ol style="list-style-type: decimal">
<li>treat each group as a distinct data set</li>
<li>execute their code separately on each group</li>
<li>combine the results into a new data frame that contains the same grouping characteristics. <code>summarise()</code> is a slight exception, see below.</li>
</ol>
</div>
</div>
</div>
<div id="summarise-data-by-groups" class="section level2">
<h2><span class="header-section-number">4.18</span> Summarise data by groups</h2>
<p>You want to compute summary statistics for different subgroups of data in your grouped data frame.</p>
<p><img src="images/dplyr-group_by.png" style="display: block; margin: auto;" /></p>
<div id="solution-17" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb115-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb115-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(cases), <span class="dt">max_rate =</span> <span class="kw">max</span>(cases<span class="op">/</span>population))</a></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 3 x 3
##   country     total_cases max_rate
##   &lt;chr&gt;             &lt;int&gt;    &lt;dbl&gt;
## 1 Afghanistan        3411 0.000129
## 2 Brazil           118225 0.000461
## 3 China            426024 0.000167</code></pre>
</div>
<div id="discussion-15" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>Group-wise summaries are the most common use of grouped data. When you apply <code>summarise()</code> to grouped data, <code>summarise()</code> will:</p>
<ol style="list-style-type: decimal">
<li>treat each group as a distinct data set</li>
<li>compute separate statistics for each group</li>
<li><p>combine the results into a new tibble</p>

<div class="rmdcaution">
Since this is easier to see than explain, you may want to study the diagram and result above.
</div></li>
</ol>
<p><code>summarise()</code> gives grouped data special treatment in two ways:</p>
<ol style="list-style-type: decimal">
<li><p><code>summarise()</code> will retain the column(s) that were used to group the data in its result. This makes the output of grouped summaries interpretable.</p></li>
<li><p><code>summarise()</code> will shorten the grouping criteria of its result by one column name (the last column name). Compare this to other tidyverse functions which give their result the <em>same</em> grouping criteria as their input.</p>
<p>For example, if the input of <code>summarise()</code> is grouped by <code>country</code> and <code>year</code>, the output of <code>summarise()</code> will only be grouped by <code>country</code>. Because of this, you can call <code>summarise()</code> repeatedly to view progressively higher level summaries:</p></li>
</ol>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb118-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country, year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb118-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(cases))</a></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;country&#39; (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 6 x 3
## # Groups:   country [3]
##   country      year total_cases
##   &lt;chr&gt;       &lt;int&gt;       &lt;int&gt;
## 1 Afghanistan  1999         745
## 2 Afghanistan  2000        2666
## 3 Brazil       1999       37737
## 4 Brazil       2000       80488
## 5 China        1999      212258
## 6 China        2000      213766</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb121-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country, year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb121-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(cases)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb121-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(total_cases))</a></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;country&#39; (override with `.groups` argument)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 3 x 2
##   country     total_cases
##   &lt;chr&gt;             &lt;int&gt;
## 1 Afghanistan        3411
## 2 Brazil           118225
## 3 China            426024</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb125-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country, year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb125-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(cases)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb125-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(total_cases)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb125-5" data-line-number="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">total_cases =</span> <span class="kw">sum</span>(total_cases))</a></code></pre></div>
<pre><code>## `summarise()` regrouping output by &#39;country&#39; (override with `.groups` argument)</code></pre>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<pre><code>## # A tibble: 1 x 1
##   total_cases
##         &lt;int&gt;
## 1      547660</code></pre>
</div>
</div>
<div id="nest-a-data-frame" class="section level2">
<h2><span class="header-section-number">4.19</span> Nest a data frame</h2>
<p>You want to move portions of your data frame into their own tables, and then store those tables in cells in your original data frame.</p>
<p><img src="images/tidyr-nest.png" style="display: block; margin: auto;" /></p>
<p>This lets you manipulate the collection of tables with <code>filter()</code>, <code>select()</code>, <code>arrange()</code>, and so on, as you would normally manipulate a collection of values.</p>
<div id="solution-18" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb129-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb129-3" data-line-number="3"><span class="st">  </span><span class="kw">nest</span>(<span class="dt">.key =</span> <span class="st">&quot;Measurements&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: `.key` is deprecated</code></pre>
<pre><code>## # A tibble: 3 x 2
## # Groups:   Species [3]
##   Species    Measurements     
##   &lt;fct&gt;      &lt;list&gt;           
## 1 setosa     &lt;tibble [50 × 4]&gt;
## 2 versicolor &lt;tibble [50 × 4]&gt;
## 3 virginica  &lt;tibble [50 × 4]&gt;</code></pre>
</div>
<div id="discussion-16" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>nest()</code> comes in the tidyr package. You can use it to nest portions of your data frame in two ways:</p>
<ol style="list-style-type: decimal">
<li><p>Pass <code>nest()</code> a <em>grouped data frame</em> made with <code>dplyr::group_by()</code> (as above). <code>nest()</code> will create a separate table for each group. The table will contain every row in the group and every column that is not part of the grouping criteria.</p></li>
<li><p>Pass <code>nest()</code> an ungrouped data frame and then specify which columns to nest. <code>nest()</code> will perform an implicit grouping on the combination of values that appear across the remaining columns, and then create a separate table for each implied grouping.</p>
<p>You can specify columns with the same syntax and helpers that you would use with dplyr’s <code>select()</code> function. So, for example, the two calls below will produce the same result as the solution above.</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" data-line-number="1">iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb132-2" data-line-number="2"><span class="st">  </span><span class="kw">nest</span>(Sepal.Width, </a>
<a class="sourceLine" id="cb132-3" data-line-number="3">       Sepal.Length, </a>
<a class="sourceLine" id="cb132-4" data-line-number="4">       Petal.Width, </a>
<a class="sourceLine" id="cb132-5" data-line-number="5">       Petal.Length, </a>
<a class="sourceLine" id="cb132-6" data-line-number="6">       <span class="dt">.key =</span> <span class="st">&quot;Measurements&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb132-7" data-line-number="7"><span class="st">  </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb132-8" data-line-number="8"></a>
<a class="sourceLine" id="cb132-9" data-line-number="9">iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb132-10" data-line-number="10"><span class="st">  </span><span class="kw">nest</span>(<span class="op">-</span>Species, <span class="dt">.key =</span> <span class="st">&quot;Measurements&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb132-11" data-line-number="11"><span class="st">  </span><span class="kw">as_tibble</span>()</a></code></pre></div></li>
</ol>
<p><code>nest()</code> preserves class, which means that <code>nest()</code> will return a data frame if its input is a data frame and a tibble if its input is a tibble. In each case, <code>nest()</code> will add the subtables to the result as a list-column. Since, list-columns are much easier to view in a tibble than a data frame, I recommend that you convert the result of <code>nest()</code> to a tibble when necessary.</p>
<p>Use the <code>.key</code> argument to provide a name for the new list-column.</p>
</div>
</div>
<div id="extract-a-table-from-a-nested-data-frame" class="section level2">
<h2><span class="header-section-number">4.20</span> Extract a table from a nested data frame</h2>
<p>You want to extract a single table nested within a data frame.</p>
<p><img src="images/tidyr-unnest-single.png" style="display: block; margin: auto;" /></p>
<p>For example, you want to extract the setosa table from the nested data set created in the solution above,</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">nested_iris &lt;-</a>
<a class="sourceLine" id="cb133-2" data-line-number="2"><span class="st">  </span>iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb133-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb133-4" data-line-number="4"><span class="st">  </span><span class="kw">nest</span>(<span class="dt">.key =</span> <span class="st">&quot;Measurements&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: `.key` is deprecated</code></pre>
<div id="solution-19" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">nested_iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb135-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(Species <span class="op">==</span><span class="st"> &quot;setosa&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb135-3" data-line-number="3"><span class="st">  </span><span class="kw">unnest</span>()</a></code></pre></div>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(Measurements)`</code></pre>
<pre><code>## # A tibble: 50 x 5
## # Groups:   Species [1]
##    Species Sepal.Length Sepal.Width Petal.Length Petal.Width
##    &lt;fct&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1 setosa           5.1         3.5          1.4         0.2
##  2 setosa           4.9         3            1.4         0.2
##  3 setosa           4.7         3.2          1.3         0.2
##  4 setosa           4.6         3.1          1.5         0.2
##  5 setosa           5           3.6          1.4         0.2
##  6 setosa           5.4         3.9          1.7         0.4
##  7 setosa           4.6         3.4          1.4         0.3
##  8 setosa           5           3.4          1.5         0.2
##  9 setosa           4.4         2.9          1.4         0.2
## 10 setosa           4.9         3.1          1.5         0.1
## # … with 40 more rows</code></pre>
</div>
<div id="discussion-17" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>Since the table is in a cell of the data frame, it is possible to extract the table by extracting the contents of the cell (as below). Be sure to use double brackets to extract the content itself, and not a 1 x 1 data frame that contains the cell.</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" data-line-number="1">nested_iris[[<span class="dv">1</span>, <span class="dv">2</span>]]</a></code></pre></div>
<p>However, this approach can be suboptimal for nested data. Often a nested table relies on information that is stored alongside it for meaning. For example, in the above example, the table relies on the Species variable to indicate that it describes setosa flowers.</p>
<p>You can extract a nested table along with its related information by first subsetting to just the relevant information and then unnesting the result.</p>
</div>
</div>
<div id="unnest-a-data-frame" class="section level2">
<h2><span class="header-section-number">4.21</span> Unnest a data frame</h2>
<p>You want to transform a nested data frame into a flat data frame by re-integrating the nested tables into the surrounding data frame.</p>
<p><img src="images/tidyr-unnest.png" style="display: block; margin: auto;" /></p>
<p>For example, you want to unnest the <code>nested_iris</code> data frame created in the recipe above,</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1">nested_iris &lt;-</a>
<a class="sourceLine" id="cb139-2" data-line-number="2"><span class="st">  </span>iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb139-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(Species) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb139-4" data-line-number="4"><span class="st">  </span><span class="kw">nest</span>(<span class="dt">.key =</span> <span class="st">&quot;Measurements&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: `.key` is deprecated</code></pre>
<div id="solution-20" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1"><span class="kw">unnest</span>(nested_iris)</a></code></pre></div>
<pre><code>## Warning: `cols` is now required when using unnest().
## Please use `cols = c(Measurements)`</code></pre>
<pre><code>## # A tibble: 150 x 5
## # Groups:   Species [3]
##    Species Sepal.Length Sepal.Width Petal.Length Petal.Width
##    &lt;fct&gt;          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1 setosa           5.1         3.5          1.4         0.2
##  2 setosa           4.9         3            1.4         0.2
##  3 setosa           4.7         3.2          1.3         0.2
##  4 setosa           4.6         3.1          1.5         0.2
##  5 setosa           5           3.6          1.4         0.2
##  6 setosa           5.4         3.9          1.7         0.4
##  7 setosa           4.6         3.4          1.4         0.3
##  8 setosa           5           3.4          1.5         0.2
##  9 setosa           4.4         2.9          1.4         0.2
## 10 setosa           4.9         3.1          1.5         0.1
## # … with 140 more rows</code></pre>
</div>
<div id="discussion-18" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>unnest()</code> converts a list-column into a regular column or columns, repeating the surrounding rows as necessary. <code>unnest()</code> can handle list columns that contain atomic vectors and data frames, but cannot handle list columns that contain objects that would not naturally fit into a data frame, such as model objects.</p>
<p>By default, <code>unnest()</code> will unnest every list-column in a data frame. To unnest only a subset of list-columns, pass the names of the list-columns to <code>unnest()</code> using dplyr <code>select()</code> syntax or helpers. <code>unnest()</code> will ignore unnamed list columns, excluding them from the result to return a flat data frame. <code>unnest()</code> comes in the tidyr package.</p>
<!-- 
Unnest a data frame
Create a list-column
Transform a list-column
Simplify a list-column

You want to

#### Solution {-}

#### Discussion {-}
-->
</div>
</div>
<div id="combine-transform-recipes" class="section level2">
<h2><span class="header-section-number">4.22</span> Combine transform recipes</h2>
<p>You want to transform the structure of a table, and you want to use the data within the table to do it. This is the sort of thing you do everytime you call <code>summarise()</code> or <code>mutate()</code>.</p>
<div id="solution-21" class="section level4 unnumbered">
<h4>Solution</h4>
<p>See the discussion.</p>
</div>
<div id="discussion-19" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>When you transform a data frame, you often work with several functions:</p>
<ol style="list-style-type: decimal">
<li><p>A function that transforms the <em>table</em> itself, adding columns to its structure, or building a whole new table to hold results.</p></li>
<li><p>A function that transforms the values held in the table. Since values are always held in vectors (here column vectors), this function transforms a <em>vector</em> to create a new vector that can then be added to the empty column or table created by function 1.</p></li>
<li><p>A function that mediates between 1 and 2 if the values are embedded in a list-column, which is a <em>list</em>.</p></li>
</ol>
<p>The most concise way to learn how to combine these functions is to learn about the functions in isolation, and to then have the functions call each other as necessary.</p>
<div id="an-example" class="section level5 unnumbered">
<h5>An example</h5>
<p><code>smiths</code> contains measurements that describe two fictional people: John and Mary Smith.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1">smiths</a></code></pre></div>
<pre><code>## # A tibble: 2 x 5
##   subject     time   age weight height
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 John Smith     1    33     90   1.87
## 2 Mary Smith     1    NA     NA   1.54</code></pre>
<p>To round the <code>height</code> value for each person, you would need two functions:</p>
<ol style="list-style-type: decimal">
<li><code>round()</code> which can round the values of the data vector stored in <code>smiths$height</code>.</li>
</ol>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1"><span class="kw">round</span>(smiths<span class="op">$</span>height)</a></code></pre></div>
<pre><code>## [1] 2 2</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><code>mutate()</code> which can add the results to a copy of the <code>smiths</code> table.</li>
</ol>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" data-line-number="1">smiths <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb148-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height_int =</span> <span class="kw">round</span>(height))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##   subject     time   age weight height height_int
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 John Smith     1    33     90   1.87          2
## 2 Mary Smith     1    NA     NA   1.54          2</code></pre>
<p><code>round()</code> works with data vectors. <code>mutate()</code> works with tables. Together they create the table you want.</p>
</div>
<div id="an-example-that-uses-list-columns" class="section level5 unnumbered">
<h5>An example that uses list columns</h5>
<p><code>sepals</code> is a tibble that I made for this example.<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a> It contains sepal length measurements for three species of flowers. The measurements are stored in a list-column named <code>lengths</code>.</p>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1">sepals</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   Species    lengths   
##   &lt;fct&gt;      &lt;list&gt;    
## 1 setosa     &lt;dbl [50]&gt;
## 2 versicolor &lt;dbl [50]&gt;
## 3 virginica  &lt;dbl [50]&gt;</code></pre>
<p>Each cell in <code>lengths</code> contains a data vector of 50 sepal lengths.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1"><span class="co"># For example, the first cell of lengths</span></a>
<a class="sourceLine" id="cb153-2" data-line-number="2">sepals[[<span class="dv">1</span>, <span class="dv">2</span>]]</a></code></pre></div>
<pre><code>## [[1]]
##  [1] 5.1 4.9 4.7 4.6 5.0 5.4 4.6 5.0 4.4 4.9 5.4 4.8 4.8 4.3 5.8 5.7 5.4 5.1 5.7
## [20] 5.1 5.4 5.1 4.6 5.1 4.8 5.0 5.0 5.2 5.2 4.7 4.8 5.4 5.2 5.5 4.9 5.0 5.5 4.9
## [39] 4.4 5.1 5.0 4.5 4.4 5.0 5.1 4.8 5.1 4.6 5.3 5.0</code></pre>
<p>To add the average sepal length for each species to the table, you would need three functions:</p>
<ol style="list-style-type: decimal">
<li><p><code>mean()</code> which can compute the average of a data vector in <code>lengths</code></p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1"><span class="kw">mean</span>(sepals[[<span class="dv">1</span>, <span class="dv">2</span>]])</a></code></pre></div>
<pre><code>## Warning in mean.default(sepals[[1, 2]]): argument is not numeric or logical:
## returning NA</code></pre>
<pre><code>## [1] NA</code></pre></li>
<li><p><code>map_dbl()</code> which can apply <code>mean()</code> to each cell of <code>lengths</code>, which is a list-column.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1"><span class="kw">map_dbl</span>(sepals<span class="op">$</span>lengths, mean)</a></code></pre></div>
<pre><code>## [1] 5.006 5.936 6.588</code></pre></li>
<li><p><code>mutate()</code> which can add the results to a copy of the <code>sepals</code> table.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1">sepals <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb160-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">avg_length =</span> <span class="kw">map_dbl</span>(lengths, mean))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   Species    lengths    avg_length
##   &lt;fct&gt;      &lt;list&gt;          &lt;dbl&gt;
## 1 setosa     &lt;dbl [50]&gt;       5.01
## 2 versicolor &lt;dbl [50]&gt;       5.94
## 3 virginica  &lt;dbl [50]&gt;       6.59</code></pre></li>
</ol>
<p><code>mean()</code> works with data vectors. <code>map_dbl()</code> works with list-columns. <code>mutate()</code> works with tables. Together they create the table you want.</p>
</div>
</div>
</div>
<div id="joins" class="section level2">
<h2><span class="header-section-number">4.23</span> Join data sets by common column(s)</h2>
<p>You want to combine two data frames into a single data frame, such that observations in the first data frame are matched to the corresponding observations in the second data frame, even if those observations do not appear in the same order.</p>
<p>Your data is structured in such a way that you can match observations by the values of one or more ID columns that appear in both data frames.</p>
<p><img src="images/dplyr-left-join.png" style="display: block; margin: auto;" /></p>
<p>For example, you would like to combine <code>band_members</code> and <code>band_instruments</code> into a single data frame based on the values of the <code>name</code> column. The new data frame will correctly list who plays what.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1">band_members</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 Mick  Stones 
## 2 John  Beatles
## 3 Paul  Beatles</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1">band_instruments</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name  plays 
##   &lt;chr&gt; &lt;chr&gt; 
## 1 John  guitar
## 2 Paul  bass  
## 3 Keith guitar</code></pre>
<div id="solution-22" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1">band_members <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb166-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(band_instruments, <span class="dt">by =</span> <span class="st">&quot;name&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass</code></pre>
</div>
<div id="discussion-20" class="section level4 unnumbered">
<h4>Discussion</h4>
<p>There are four ways to join content from one data frame to another. Each uses a different function name, but the same arguments and syntax. Of these, <code>left_join()</code> is the most common.</p>
<ol style="list-style-type: decimal">
<li><p><code>left_join()</code> drops any row in the <em>second</em> data set does not match a row in the first data set. (It retains every row in the first data set, which appears on the left when you type the function call, hence the name).</p>
<p><img src="images/dplyr-left-join.png" style="display: block; margin: auto;" /></p></li>
<li><p><code>right_join()</code> drops any row in the <em>first</em> data set does not match a row in the first data set.</p>
<p><img src="images/dplyr-right-join.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1">band_members <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb168-2" data-line-number="2"><span class="st">  </span><span class="kw">right_join</span>(band_instruments, <span class="dt">by =</span> <span class="st">&quot;name&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 John  Beatles guitar
## 2 Paul  Beatles bass  
## 3 Keith &lt;NA&gt;    guitar</code></pre></li>
<li><p><code>inner_join()</code> drops any row in <em>either</em> data set that does not have a match in both data sets, i.e. <code>inner_join()</code> does not retain any incomplete rows in the final result.</p>
<p><img src="images/dplyr-inner-join.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1">band_members <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb170-2" data-line-number="2"><span class="st">  </span><span class="kw">inner_join</span>(band_instruments, <span class="dt">by =</span> <span class="st">&quot;name&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 John  Beatles guitar
## 2 Paul  Beatles bass</code></pre></li>
<li><p><code>full_join()</code> retains every row from both data sets; it is the only join guaranteed to retain all of the original data.</p>
<p><img src="images/dplyr-full-join.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" data-line-number="1">band_members <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb172-2" data-line-number="2"><span class="st">  </span><span class="kw">full_join</span>(band_instruments, <span class="dt">by =</span> <span class="st">&quot;name&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass  
## 4 Keith &lt;NA&gt;    guitar</code></pre></li>
</ol>
<div id="mutating-joins" class="section level5 unnumbered">
<h5>Mutating joins</h5>
<p><code>left_join()</code>, <code>right_join()</code>, <code>inner_join()</code>, and <code>full_join()</code> are collectively called <em>mutating joins</em> because they add additional columns to a copy of a data set, as does <code>mutate()</code>.</p>
</div>
<div id="specifying-columns-to-join-on" class="section level5 unnumbered">
<h5>Specifying column(s) to join on</h5>
<p>By default, the mutating join functions will join on the set of columns whose names appear in both data frames. The join functions will match each row in the first data frame to the row in the second data frame that has the same combination of values across the commonly named columns.</p>
<p>To override the default, add a <code>by</code> argument to your join function. Pass it the name(s) of the column(s) to join on as a character vector. These names should appear in both data sets. R will join together rows that contain the same combination of values in these columns, ignoring the values in other columns, even if those columns share a name with a column in the other data frame.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1">table1 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb174-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(table3, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;country&quot;</span>, <span class="st">&quot;year&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   country      year  cases population rate             
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999    745   19987071 745/19987071     
## 2 Afghanistan  2000   2666   20595360 2666/20595360    
## 3 Brazil       1999  37737  172006362 37737/172006362  
## 4 Brazil       2000  80488  174504898 80488/174504898  
## 5 China        1999 212258 1272915272 212258/1272915272
## 6 China        2000 213766 1280428583 213766/1280428583</code></pre>
</div>
<div id="joining-when-id-names-do-not-match" class="section level5 unnumbered">
<h5>Joining when ID names do not match</h5>
<p>Often an ID variable will appear with a different name in each data frame. For example, the <code>name</code> variable appears as <code>artist</code> in <code>band_instruments2</code>.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" data-line-number="1">band_instruments2</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   artist plays 
##   &lt;chr&gt;  &lt;chr&gt; 
## 1 John   guitar
## 2 Paul   bass  
## 3 Keith  guitar</code></pre>
<p>To join by two columns that have different names, pass <code>by</code> a named character vector: each element of the vector should be a pair of names, e.g.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1"><span class="kw">c</span>(<span class="dt">name1 =</span> <span class="st">&quot;name2&quot;</span>, <span class="dt">name4 =</span> <span class="st">&quot;name4&quot;</span>)</a></code></pre></div>
<p>For each element,</p>
<ol style="list-style-type: decimal">
<li>Write the name of the column that appears in the first data frame</li>
<li>Write an equals sign</li>
<li>Write the name of the matching column that appears in the second data set.</li>
</ol>
<p>Only the second name needs to be surrounded with quotation marks. The join will match the corresponding columns across data frames.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" data-line-number="1">band_members <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb179-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(band_instruments2, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">name =</span> <span class="st">&quot;artist&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass</code></pre>
<p>R will use the column name(s) from the first data set in the result.</p>
</div>
<div id="suffixes" class="section level5 unnumbered">
<h5>Suffixes</h5>
<p>Joins will append the suffixes <code>.x</code> and <code>.y</code> to any columns that have the same name in both data sets <em>but are not used to join on</em>. The columns from the first data set are suffixed with <code>.x</code>, the columns from the second with <code>.y</code>.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" data-line-number="1">table4a <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb181-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(table4b, <span class="dt">by =</span> <span class="st">&quot;country&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   country     `1999.x` `2000.x`   `1999.y`   `2000.y`
##   &lt;chr&gt;          &lt;int&gt;    &lt;int&gt;      &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan      745     2666   19987071   20595360
## 2 Brazil         37737    80488  172006362  174504898
## 3 China         212258   213766 1272915272 1280428583</code></pre>
<p>To use different suffixes, supply a character vector of length two as a <code>suffix</code> argument.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" data-line-number="1">table4a <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb183-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(table4b, <span class="dt">by =</span> <span class="st">&quot;country&quot;</span>, <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;_cases&quot;</span>, <span class="st">&quot;_pop&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   country     `1999_cases` `2000_cases` `1999_pop` `2000_pop`
##   &lt;chr&gt;              &lt;int&gt;        &lt;int&gt;      &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan          745         2666   19987071   20595360
## 2 Brazil             37737        80488  172006362  174504898
## 3 China             212258       213766 1272915272 1280428583</code></pre>
</div>
</div>
</div>
<div id="find-rows-that-have-a-match-in-another-data-set" class="section level2">
<h2><span class="header-section-number">4.24</span> Find rows that have a match in another data set</h2>
<p>You want to find the rows in one data frame that have a match in a second data frame. By match, you mean that both rows refer to the same observation, even if they include different measurements.</p>
<p>Your data is structured in such a way that you can match rows by the values of one or more ID columns that appear in both data frames.</p>
<p><img src="images/dplyr-semi-join.png" style="display: block; margin: auto;" /></p>
<p>For example, you would like to return the rows of <code>band_members</code> that have a corresponding row in <code>band_instruments</code>. The new data frame will be a reduced version of <code>band_members</code> that does not contain any new columns.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" data-line-number="1">band_members</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 Mick  Stones 
## 2 John  Beatles
## 3 Paul  Beatles</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1">band_instruments</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name  plays 
##   &lt;chr&gt; &lt;chr&gt; 
## 1 John  guitar
## 2 Paul  bass  
## 3 Keith guitar</code></pre>
<div id="solution-23" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">band_members <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb189-2" data-line-number="2"><span class="st">  </span><span class="kw">semi_join</span>(band_instruments, <span class="dt">by =</span> <span class="st">&quot;name&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 John  Beatles
## 2 Paul  Beatles</code></pre>
</div>
<div id="discussion-21" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>semi_join()</code> returns only the rows of the first data frame that <em>have</em> a match in the second data frame. A match is a row that would be combined with the first row by a <a href="transform-tables.html#joins">mutating join</a>. This makes <code>semi_join()</code> a useful way to preview which rows will be retained by a mutating join.</p>
<p><code>semi_join()</code> uses the same syntax as mutating joins. Learn more in <a href="transform-tables.html#specifying-columns-to-join-on">Specifying column(s) to join on</a> and <a href="transform-tables.html#joining-when-id-names-do-not-match">Joining when ID names do not match</a>.</p>
<div id="filtering-joins" class="section level5 unnumbered">
<h5>Filtering joins</h5>
<p><code>semi_join()</code> and <code>anti_join()</code> (see below) are called <em>filtering joins</em> because they filter a data frame to only those rows that meet a specific criteria, as does <code>filter()</code>.</p>
<p>Unlike mutating joins, filtering joins do not add columns from the second data frame to the first. Instead, they use the second data frame to identify rows to return from the first.</p>
<p>When you need to filter on a complicated set of conditions, filtering joins can be more effective than <code>filter()</code>: use <code>tribble()</code> to create a data frame to filter against with a filtering join.</p>
</div>
</div>
</div>
<div id="find-rows-that-do-not-have-a-match-in-another-data-set" class="section level2">
<h2><span class="header-section-number">4.25</span> Find rows that do not have a match in another data set</h2>
<p>You want to find the rows in one data frame that <em>do not</em> have a match in a second data frame. By match, you mean that both rows refer to the same observation, even if they include different measurements.</p>
<p>Your data is structured in such a way that you can match rows by the values of one or more ID columns that appear in both data frames.</p>
<p><img src="images/dplyr-anti-join.png" style="display: block; margin: auto;" /></p>
<p>For example, you would like to return the rows of <code>band_members</code> that do not have a corresponding row in <code>band_instruments</code>. The new data frame will be a reduced version of <code>band_members</code> that does not contain any new columns.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1">band_members</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 Mick  Stones 
## 2 John  Beatles
## 3 Paul  Beatles</code></pre>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" data-line-number="1">band_instruments</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name  plays 
##   &lt;chr&gt; &lt;chr&gt; 
## 1 John  guitar
## 2 Paul  bass  
## 3 Keith guitar</code></pre>
<div id="solution-24" class="section level4 unnumbered">
<h4>Solution</h4>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" data-line-number="1">band_members <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb195-2" data-line-number="2"><span class="st">  </span><span class="kw">anti_join</span>(band_instruments, <span class="dt">by =</span> <span class="st">&quot;name&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   name  band  
##   &lt;chr&gt; &lt;chr&gt; 
## 1 Mick  Stones</code></pre>
</div>
<div id="discussion-22" class="section level4 unnumbered">
<h4>Discussion</h4>
<p><code>anti_join()</code> returns only the rows of the first data frame that <em>do not have</em> a match in the second data frame. A match is a row that would be combined with the first row by a <a href="transform-tables.html#joins">mutating join</a>. This makes <code>ant_join()</code> a useful way to debug a mutating join.</p>
<p><code>anti_join()</code> provides a useful way to check for typos that could interfere with a mutating join; these rows will not have a match in the second data frame (assuming that the typo does not also appear in the second data frame).</p>
<p><code>anti_join()</code> also highlights entries that are coded in different ways across data frames, such as <code>&quot;North_Carolina&quot;</code> and <code>&quot;North Carolina&quot;</code>.</p>
<p><code>anti_join()</code> uses the same syntax as mutating joins. Learn more in <a href="transform-tables.html#specifying-columns-to-join-on">Specifying column(s) to join on</a> and <a href="transform-tables.html#joining-when-id-names-do-not-match">Joining when ID names do not match</a>. Along with <code>semi_join()</code>, <code>anti_join()</code> is one of the two <a href="transform-tables.html#filtering-joins">Filtering joins</a>.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Or one that can be made the same length with R’s recycling rules, e.g. a vector of length one.<a href="transform-tables.html#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p><code>summarise()</code> will return a larger tibble if you pair it with <code>group_by()</code>.<a href="transform-tables.html#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>Attributes are metadata associated with a data structure. R can see an object’s attributes, but users typically cannot.<a href="transform-tables.html#fnref3" class="footnote-back">↩</a></p></li>
<li id="fn4"><p>I made this data frame with the code <code>sepals &lt;- iris %&gt;%    group_by(Species) %&gt;%    summarise(lengths = list(Sepal.Length))</code><a href="transform-tables.html#fnref4" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tidy.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="transform-lists-and-vectors.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio-education/tidyverse-cookbook/edit/master/04-transform-tables.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
